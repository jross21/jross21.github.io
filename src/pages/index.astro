---
import BaseLayout from '../layouts/BaseLayout.astro';
import TerminalPanel from '../components/TerminalPanel.astro';
import TerminalProjectCard from '../components/TerminalProjectCard.astro';
import TerminalPostCard from '../components/TerminalPostCard.astro';
import CommandButton from '../components/CommandButton.astro';
import { getCollection } from 'astro:content';

const allWork = await getCollection('work');
const allWriting = await getCollection('writing');

const featuredProjects = allWork.filter(p => p.data.featured).slice(0, 3);
const curatedWritingSlugs = [
  'ai-project-will-fail',
  'governance-stack',
  'gtm-knowledge-system',
];
const writingBySlug = new Map(allWriting.map((post) => [post.slug, post]));
const featuredEssays = curatedWritingSlugs
  .map((slug) => writingBySlug.get(slug))
  .filter((post): post is typeof allWriting[number] => Boolean(post));
---

<BaseLayout
  fullWidth={true}
  title="Julian Ross"
  description="Revenue Systems Architect focused on AI-native RevOps, GTM automation, and data infrastructure."
>
  <!-- Hero -->
  <section class="section-immersive pt-12 md:pt-20">
    <div class="section-immersive-content">
      <div class="animate-in max-w-3xl">
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-[var(--color-text)] mb-6 leading-tight">
          Revenue Systems Architect for AI-native GTM teams.
        </h1>

        <div class="text-lg md:text-xl text-[var(--color-text-muted)] leading-relaxed max-w-2xl mb-8">
          Data integrity and governance that make automation reliable and adopted.
        </div>

        <div class="flex flex-wrap gap-3">
          <CommandButton
            href="/contact"
            command="Start a conversation"
            size="lg"
            primary={true}
            section="contact"
          />
        </div>
      </div>
    </div>
  </section>

  <!-- Results + Projects -->
  {featuredProjects.length > 0 && (
    <section class="section-immersive section-alt">
      <div class="section-immersive-content animate-in">
        <h2 class="text-2xl md:text-3xl font-bold text-[var(--color-text)] mb-8">
          Results <span class="text-[var(--color-section-projects)]">and Projects</span>
        </h2>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center mb-8">
          <div>
            <p class="text-3xl md:text-4xl font-bold text-[var(--color-accent)]">$8M+</p>
            <p class="text-sm text-[var(--color-text-muted)] mt-2">Qualified pipeline led</p>
          </div>
          <div>
            <p class="text-3xl md:text-4xl font-bold text-[var(--color-accent)]">~40%</p>
            <p class="text-sm text-[var(--color-text-muted)] mt-2">Pipeline growth</p>
          </div>
          <div>
            <p class="text-3xl md:text-4xl font-bold text-[var(--color-accent)]">$350K/mo</p>
            <p class="text-sm text-[var(--color-text-muted)] mt-2">Pipeline produced</p>
          </div>
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 pl-4 md:pl-6 border-l border-[var(--color-border)]">
          {featuredProjects.map((project) => (
            <TerminalProjectCard
              title={project.data.title}
              description={project.data.description}
              slug={project.slug}
              date={project.data.date}
            />
          ))}
        </div>

        <div class="mt-8">
          <CommandButton href="/projects" command="View all projects" section="projects" />
        </div>
      </div>
    </section>
  )}

  <!-- Writing + CTA -->
  <section class="section-immersive section-alt">
    <div class="section-immersive-content">
      <div class="grid md:grid-cols-2 gap-8 md:gap-12">
        <!-- Writing -->
        {featuredEssays.length > 0 && (
          <div class="animate-in">
            <h2 class="text-2xl font-bold text-[var(--color-text)] mb-6">
              Selected <span class="text-[var(--color-section-writing)]">Writing</span>
            </h2>

            <div class="pl-4 md:pl-6 border-l border-[var(--color-border)]">
              {featuredEssays.map((post) => (
                <TerminalPostCard
                  title={post.data.title}
                  description={post.data.description}
                  slug={post.slug}
                  category={post.data.category}
                />
              ))}
            </div>

            <div class="mt-6">
              <CommandButton href="/thinking" command="View all writing" section="writing" />
            </div>
          </div>
        )}

        <!-- CTA -->
        <div class="animate-in animate-delay-1">
          <h2 class="text-2xl font-bold text-[var(--color-text)] mb-4">
            Let's <span class="text-[var(--color-section-contact)]">Connect</span>
          </h2>

          <p class="text-[var(--color-text-muted)] mb-6">
            Leading RevOps or revenue systems? I bring a track record across GTM, data, and AI to ship workflows that teams actually use.
          </p>

          <TerminalPanel title="Get in touch">
            <div class="text-sm text-[var(--color-text-muted)]">
              Share the context you're working with and I'll follow up with ideas and next steps.
            </div>
            <div class="mt-4">
              <CommandButton
                href="/contact"
                command="Start a conversation"
                primary={true}
                section="contact"
              />
            </div>
          </TerminalPanel>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
