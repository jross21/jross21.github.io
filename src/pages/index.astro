---
import BaseLayout from '../layouts/BaseLayout.astro';
import TerminalProjectCard from '../components/TerminalProjectCard.astro';
import TerminalPostCard from '../components/TerminalPostCard.astro';
import CommandButton from '../components/CommandButton.astro';
import AnimatedStat from '../components/AnimatedStat.astro';
import ScrollReveal from '../components/ScrollReveal.astro';
import { getCollection } from 'astro:content';

const allWork = await getCollection('work');
const allWriting = await getCollection('writing');

const featuredProjects = allWork.filter(p => p.data.featured).slice(0, 3);
const curatedWritingSlugs = [
  'ai-project-will-fail',
  'what-agentic-means',
  'distribution-bottleneck',
];
const writingBySlug = new Map(allWriting.map((post) => [post.slug, post]));
const featuredEssays = curatedWritingSlugs
  .map((slug) => writingBySlug.get(slug))
  .filter((post): post is typeof allWriting[number] => Boolean(post));
---

<BaseLayout
  fullWidth={true}
  title="Julian Ross"
  description="Revenue Operations leader — I build the data infrastructure, automation, and AI workflows that make revenue teams predictable."
>
  <!-- 1. Hero with gradient mesh -->
  <section class="section-immersive pt-12 md:pt-20 relative overflow-hidden">
    <div class="hero-mesh" aria-hidden="true"></div>
    <div class="section-immersive-content relative z-10">
      <ScrollReveal>
        <div class="max-w-3xl">
          <h1 class="text-4xl md:text-5xl lg:text-7xl text-[var(--color-text)] mb-6 leading-[1.05]">
            I build the systems that make revenue teams <span class="text-[var(--color-accent)]">predictable</span>.
          </h1>

          <p class="text-lg md:text-xl text-[var(--color-text-muted)] leading-relaxed max-w-2xl mb-8">
            From SDR to data engineer to AI-native RevOps — I've worked every layer of the GTM stack and I build the infrastructure that makes the rest of it work.
          </p>

          <div class="flex flex-wrap gap-3">
            <CommandButton
              href="/projects"
              command="See my work"
              size="lg"
              primary={true}
              section="projects"
            />
            <CommandButton
              href="/resume"
              command="Resume"
              size="lg"
              section="about"
            />
          </div>
        </div>
      </ScrollReveal>
    </div>
  </section>

  <!-- 2. Impact Stats -->
  <section class="section-immersive section-alt">
    <div class="section-immersive-content">
      <ScrollReveal>
        <div class="section-label mb-6">Impact</div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 stagger-grid">
          <AnimatedStat
            value="8"
            prefix="$"
            suffix="M+"
            label="Pipeline"
            sublabel="across 3 engagements"
          />
          <AnimatedStat
            value="40"
            prefix="~"
            suffix="%"
            label="Pipeline growth"
            sublabel="quarter-over-quarter"
          />
          <AnimatedStat
            value="350"
            prefix="$"
            suffix="K/mo"
            label="Pipeline produced"
            sublabel="from automated workflows"
          />
        </div>
      </ScrollReveal>
    </div>
  </section>

  <!-- 3. Featured Projects -->
  {featuredProjects.length > 0 && (
    <section class="section-immersive">
      <div class="section-immersive-content">
        <ScrollReveal>
          <div class="section-label mb-2">Work</div>
          <h2 class="text-2xl md:text-3xl text-[var(--color-text)] mb-8">
            Featured <span class="text-[var(--color-section-projects)]">Projects</span>
          </h2>

          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 stagger-grid">
            {featuredProjects.map((project) => (
              <TerminalProjectCard
                title={project.data.title}
                description={project.data.description}
                slug={project.slug}
                date={project.data.date}
              />
            ))}
          </div>

          <div class="mt-8">
            <CommandButton href="/projects" command="View all projects" section="projects" />
          </div>
        </ScrollReveal>
      </div>
    </section>
  )}

  <!-- 4. Selected Writing -->
  {featuredEssays.length > 0 && (
    <section class="section-immersive section-alt">
      <div class="section-immersive-content">
        <ScrollReveal>
          <div class="section-label mb-2">Ideas</div>
          <h2 class="text-2xl md:text-3xl text-[var(--color-text)] mb-6">
            Selected <span class="text-[var(--color-section-writing)]">Writing</span>
          </h2>

          <div class="grid md:grid-cols-3 gap-6 stagger-grid">
            {featuredEssays.map((post) => (
              <TerminalPostCard
                title={post.data.title}
                description={post.data.description}
                slug={post.slug}
                category={post.data.category}
              />
            ))}
          </div>

          <div class="mt-6">
            <CommandButton href="/ideas" command="View all writing" section="writing" />
          </div>
        </ScrollReveal>
      </div>
    </section>
  )}

  <!-- 5. CTA -->
  <section class="section-immersive">
    <div class="section-immersive-content">
      <ScrollReveal>
        <div class="max-w-xl">
          <h2 class="text-3xl md:text-4xl text-[var(--color-text)] mb-4">
            Let's talk.
          </h2>
          <p class="text-lg text-[var(--color-text-muted)] mb-2 leading-relaxed">
            I'm looking for a RevOps or GTM Engineering role where I can own infrastructure end-to-end. If that sounds useful, reach out.
          </p>
          <p class="text-[var(--color-text-muted)] mb-6">
            <span class="text-[var(--color-text)]">jross21@gmail.com</span>
          </p>
          <div class="flex flex-wrap gap-3">
            <CommandButton
              href="/resume"
              command="Resume"
              primary={true}
              section="about"
            />
            <CommandButton
              href="mailto:jross21@gmail.com"
              command="Email me"
              section="contact"
            />
          </div>
        </div>
      </ScrollReveal>
    </div>
  </section>
</BaseLayout>
