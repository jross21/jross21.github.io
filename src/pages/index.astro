---
import BaseLayout from '../layouts/BaseLayout.astro';
import TerminalPanel from '../components/TerminalPanel.astro';
import TerminalProjectCard from '../components/TerminalProjectCard.astro';
import TerminalPostCard from '../components/TerminalPostCard.astro';
import CommandButton from '../components/CommandButton.astro';
import HeroSystemDiagram from '../components/graphics/HeroSystemDiagram.astro';
import AnimatedStat from '../components/AnimatedStat.astro';
import LogoBar from '../components/LogoBar.astro';
import AvailabilityBadge from '../components/AvailabilityBadge.astro';
import { getCollection } from 'astro:content';

const allWork = await getCollection('work');
const allWriting = await getCollection('writing');

const featuredProjects = allWork.filter(p => p.data.featured).slice(0, 3);
const curatedWritingSlugs = [
  'ai-project-will-fail',
  'what-agentic-means',
  'distribution-bottleneck',
];
const writingBySlug = new Map(allWriting.map((post) => [post.slug, post]));
const featuredEssays = curatedWritingSlugs
  .map((slug) => writingBySlug.get(slug))
  .filter((post): post is typeof allWriting[number] => Boolean(post));
---

<BaseLayout
  fullWidth={true}
  title="Julian Ross"
  description="Revenue Systems Architect focused on AI-native RevOps, GTM automation, and data infrastructure."
>
  <!-- 1. Hero -->
  <section class="section-immersive pt-12 md:pt-20">
    <div class="section-immersive-content">
      <div class="animate-in max-w-3xl">
        <div class="mb-4">
          <AvailabilityBadge />
        </div>
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-[var(--color-text)] mb-6 leading-tight whitespace-nowrap">
          Revenue Systems Architect for AI-native GTM
        </h1>

        <div class="text-lg md:text-xl text-[var(--color-text-muted)] leading-relaxed max-w-2xl mb-8">
          Reliable data. Predictable automation. Measurable outcomes.
        </div>

        <div class="flex flex-wrap gap-3">
          <CommandButton
            href="/contact"
            command="Start a conversation"
            size="lg"
            primary={true}
            section="contact"
          />
          <CommandButton
            href="https://cal.com/julianross"
            command="Book a call"
            size="lg"
            section="contact"
          />
        </div>
      </div>

      <!-- System Diagram -->
      <div class="mt-12 md:mt-16 animate-in animate-delay-2">
        <HeroSystemDiagram />
      </div>
    </div>
  </section>

  <!-- 2. Results + Stats -->
  <section class="section-immersive section-alt">
    <div class="section-immersive-content animate-in">
      <h2 class="text-2xl md:text-3xl font-bold text-[var(--color-text)] mb-8">
        Results
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-12">
        <AnimatedStat
          value="8"
          prefix="$"
          suffix="M+"
          label="Qualified pipeline led"
        />
        <AnimatedStat
          value="40"
          prefix="~"
          suffix="%"
          label="Pipeline growth"
        />
        <AnimatedStat
          value="350"
          prefix="$"
          suffix="K/mo"
          label="Pipeline produced"
        />
      </div>
    </div>
  </section>

  <!-- 3. Featured Projects -->
  {featuredProjects.length > 0 && (
    <section class="section-immersive">
      <div class="section-immersive-content animate-in">
        <h2 class="text-2xl md:text-3xl font-bold text-[var(--color-text)] mb-8">
          Featured <span class="text-[var(--color-section-projects)]">Projects</span>
        </h2>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 pl-4 md:pl-6 border-l border-[var(--color-border)]">
          {featuredProjects.map((project) => (
            <TerminalProjectCard
              title={project.data.title}
              description={project.data.description}
              slug={project.slug}
              date={project.data.date}
            />
          ))}
        </div>

        <div class="mt-8">
          <CommandButton href="/projects" command="View all projects" section="projects" />
        </div>
      </div>
    </section>
  )}

  <!-- 4. Testimonials -->
  <!-- TODO: Replace with real testimonials -->
  <section class="section-immersive section-alt">
    <div class="section-immersive-content animate-in">
      <h2 class="text-2xl md:text-3xl font-bold text-[var(--color-text)] mb-8">
        What People Say
      </h2>

      <div class="grid md:grid-cols-3 gap-6">
        <div class="terminal-panel">
          <div class="terminal-panel__body">
            <blockquote class="text-sm text-[var(--color-text-muted)] italic border-l-2 border-[var(--color-section-projects)] pl-4 mb-4" style="margin:0;">
              "Julian rebuilt our entire lead routing and CRM architecture in weeks. Pipeline visibility went from guesswork to real-time, and our reps finally trusted the data they were working from."
            </blockquote>
            <div class="text-sm">
              <span class="text-[var(--color-text)] font-medium">VP of Revenue Operations</span>
              <span class="text-[var(--color-text-dim)]"> · Series B SaaS</span>
            </div>
          </div>
        </div>

        <div class="terminal-panel">
          <div class="terminal-panel__body">
            <blockquote class="text-sm text-[var(--color-text-muted)] italic border-l-2 border-[var(--color-section-writing)] pl-4 mb-4" style="margin:0;">
              "Most consultants hand you a deck. Julian handed us a production system with monitoring, validation, and rollback. The AI workflows he built actually survived contact with real data."
            </blockquote>
            <div class="text-sm">
              <span class="text-[var(--color-text)] font-medium">Head of Data</span>
              <span class="text-[var(--color-text-dim)]"> · Growth-stage B2B</span>
            </div>
          </div>
        </div>

        <div class="terminal-panel">
          <div class="terminal-panel__body">
            <blockquote class="text-sm text-[var(--color-text-muted)] italic border-l-2 border-[var(--color-section-about)] pl-4 mb-4" style="margin:0;">
              "What sets Julian apart is range. He can whiteboard the data model with engineering, then walk the CRO through the forecast logic in the same afternoon. That bridge is rare."
            </blockquote>
            <div class="text-sm">
              <span class="text-[var(--color-text)] font-medium">CTO</span>
              <span class="text-[var(--color-text-dim)]"> · AI Infrastructure Startup</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 5. Selected Writing -->
  {featuredEssays.length > 0 && (
    <section class="section-immersive">
      <div class="section-immersive-content animate-in">
        <h2 class="text-2xl md:text-3xl font-bold text-[var(--color-text)] mb-6">
          Selected <span class="text-[var(--color-section-writing)]">Writing</span>
        </h2>

        <div class="grid md:grid-cols-3 gap-4">
          {featuredEssays.map((post) => (
            <TerminalPostCard
              title={post.data.title}
              description={post.data.description}
              slug={post.slug}
              category={post.data.category}
            />
          ))}
        </div>

        <div class="mt-6">
          <CommandButton href="/ideas" command="View all writing" section="writing" />
        </div>
      </div>
    </section>
  )}

  <!-- 6. LogoBar + Final CTA -->
  <section class="section-immersive section-alt">
    <div class="section-immersive-content">
      <LogoBar />

      <div class="mt-12 text-center">
        <h2 class="text-2xl font-bold text-[var(--color-text)] mb-4">
          Let's <span class="text-[var(--color-section-contact)]">Connect</span>
        </h2>
        <p class="text-[var(--color-text-muted)] mb-6 max-w-lg mx-auto">
          Leading RevOps or revenue systems? I bring a track record across GTM, data, and AI to ship workflows that teams actually use.
        </p>
        <div class="flex flex-wrap gap-3 justify-center">
          <CommandButton
            href="/contact"
            command="Start a conversation"
            primary={true}
            section="contact"
          />
          <CommandButton
            href="https://cal.com/julianross"
            command="Book a call"
            section="contact"
          />
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
