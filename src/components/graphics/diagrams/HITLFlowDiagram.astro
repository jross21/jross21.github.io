---
/**
 * HITLFlowDiagram.astro
 *
 * Simple vertical 4-step flow showing the "inbox pattern":
 * AI Proposes → Review Inbox → Human Reviews → Approve/Reject
 */
interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<div class:list={['hitl-flow-diagram', className]}>
  <svg
    viewBox="0 0 220 280"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class="hitl-flow-diagram__svg"
    role="img"
    aria-labelledby="hitl-title"
  >
    <title id="hitl-title">Human-in-the-Loop Workflow</title>

    <!-- Step 1: AI Proposes -->
    <g class="step">
      <rect x="20" y="0" width="160" height="50" rx="6" class="step-box"/>
      <text x="100" y="30" text-anchor="middle" class="step-label">AI Proposes</text>
    </g>

    <!-- Arrow 1 -->
    <g class="arrow">
      <line x1="100" y1="55" x2="100" y2="75" class="arrow-line"/>
      <polygon points="100,75 96,68 104,68" class="arrow-head"/>
    </g>

    <!-- Step 2: Review Inbox -->
    <g class="step">
      <rect x="20" y="80" width="160" height="50" rx="6" class="step-box step-box--primary"/>
      <text x="100" y="110" text-anchor="middle" class="step-label">Review Inbox</text>
    </g>

    <!-- Arrow 2 -->
    <g class="arrow">
      <line x1="100" y1="135" x2="100" y2="155" class="arrow-line"/>
      <polygon points="100,155 96,148 104,148" class="arrow-head"/>
    </g>

    <!-- Step 3: Human Reviews -->
    <g class="step">
      <rect x="20" y="160" width="160" height="50" rx="6" class="step-box"/>
      <text x="100" y="190" text-anchor="middle" class="step-label">Human Reviews</text>
    </g>

    <!-- Arrow 3 -->
    <g class="arrow">
      <line x1="100" y1="215" x2="100" y2="235" class="arrow-line"/>
      <polygon points="100,235 96,228 104,228" class="arrow-head"/>
    </g>

    <!-- Step 4: Outcome -->
    <g class="step">
      <rect x="25" y="240" width="75" height="36" rx="4" class="step-box step-box--approve"/>
      <text x="62" y="262" text-anchor="middle" class="step-label step-label--small">Approve</text>

      <rect x="120" y="240" width="75" height="36" rx="4" class="step-box step-box--reject"/>
      <text x="157" y="262" text-anchor="middle" class="step-label step-label--small">Reject</text>
    </g>
  </svg>
</div>

<style>
  .hitl-flow-diagram {
    width: 100%;
    max-width: 220px;
    margin: 0 auto;
  }

  .hitl-flow-diagram__svg {
    width: 100%;
    height: auto;
  }

  .step-box {
    fill: var(--color-bg-subtle);
    stroke: var(--color-border);
    stroke-width: 1.5;
  }

  .step-box--primary {
    stroke: var(--color-accent);
    fill: var(--color-bg-elevated);
  }

  .step-box--approve {
    stroke: var(--color-terminal-green);
  }

  .step-box--reject {
    stroke: var(--color-error);
  }

  .step-label {
    font-family: var(--font-sans);
    font-size: 13px;
    font-weight: 600;
    fill: var(--color-text);
  }

  .step-label--small {
    font-size: 11px;
  }

  .arrow-line {
    stroke: var(--color-accent);
    stroke-width: 2;
    opacity: 0.6;
  }

  .arrow-head {
    fill: var(--color-accent);
    opacity: 0.6;
  }

  /* Light mode */
  :global(html.light) .step-box {
    fill: var(--color-bg-elevated);
  }

  :global(html.light) .step-box--primary {
    fill: var(--color-bg-subtle);
  }
</style>
