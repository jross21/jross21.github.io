---
/**
 * HeroSystemDiagram.astro
 *
 * Layered architecture diagram showing Julian's value proposition:
 * Input sources (top) → Governance Layer (center, highlighted) → Outputs (bottom)
 * Animated dashed connectors flow data through the system.
 */

interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;
---

<div class:list={['hero-diagram', className]}>
  <svg
    viewBox="0 0 600 300"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    class="hero-diagram__svg"
    aria-labelledby="diagram-title diagram-desc"
    role="img"
  >
    <title id="diagram-title">Revenue Systems Architecture</title>
    <desc id="diagram-desc">Data flows from CRM, Marketing, and Product through a Governance Layer to Routing, Scoring, Reporting, and Actions</desc>

    <!-- Input Sources (Top Row) -->
    <g class="node node--input">
      <rect x="60" y="20" width="120" height="44" rx="6" class="node-box node-box--input"/>
      <text x="120" y="47" text-anchor="middle" class="node-label">CRM</text>
    </g>

    <g class="node node--input">
      <rect x="240" y="20" width="120" height="44" rx="6" class="node-box node-box--input"/>
      <text x="300" y="47" text-anchor="middle" class="node-label">Marketing</text>
    </g>

    <g class="node node--input">
      <rect x="420" y="20" width="120" height="44" rx="6" class="node-box node-box--input"/>
      <text x="480" y="47" text-anchor="middle" class="node-label">Product</text>
    </g>

    <!-- Connectors: Inputs → Governance -->
    <line x1="120" y1="64" x2="120" y2="110" class="connector connector--down"/>
    <line x1="120" y1="110" x2="180" y2="110" class="connector connector--right"/>

    <line x1="300" y1="64" x2="300" y2="110" class="connector connector--down"/>

    <line x1="480" y1="64" x2="480" y2="110" class="connector connector--down"/>
    <line x1="480" y1="110" x2="420" y2="110" class="connector connector--left"/>

    <!-- Governance Layer (Center - the value prop) -->
    <g class="node node--governance">
      <rect x="140" y="95" width="320" height="52" rx="8" class="node-box node-box--governance"/>
      <text x="300" y="126" text-anchor="middle" class="node-label node-label--governance">Governance Layer</text>
    </g>

    <!-- Connectors: Governance → Outputs -->
    <line x1="195" y1="147" x2="105" y2="200" class="connector connector--fan"/>
    <line x1="260" y1="147" x2="235" y2="200" class="connector connector--fan"/>
    <line x1="340" y1="147" x2="365" y2="200" class="connector connector--fan"/>
    <line x1="405" y1="147" x2="495" y2="200" class="connector connector--fan"/>

    <!-- Output Nodes (Bottom Row) -->
    <g class="node node--output">
      <rect x="45" y="200" width="120" height="44" rx="6" class="node-box node-box--output"/>
      <text x="105" y="227" text-anchor="middle" class="node-label">Routing</text>
    </g>

    <g class="node node--output">
      <rect x="175" y="200" width="120" height="44" rx="6" class="node-box node-box--output"/>
      <text x="235" y="227" text-anchor="middle" class="node-label">Scoring</text>
    </g>

    <g class="node node--output">
      <rect x="305" y="200" width="120" height="44" rx="6" class="node-box node-box--output"/>
      <text x="365" y="227" text-anchor="middle" class="node-label">Reporting</text>
    </g>

    <g class="node node--output">
      <rect x="435" y="200" width="120" height="44" rx="6" class="node-box node-box--output"/>
      <text x="495" y="227" text-anchor="middle" class="node-label">Actions</text>
    </g>

    <!-- Flow direction indicators -->
    <text x="300" y="285" text-anchor="middle" class="diagram-caption">reliable data in → governed decisions out</text>
  </svg>
</div>

<style>
  .hero-diagram {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }

  .hero-diagram__svg {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Node boxes */
  .node-box {
    fill: var(--color-bg-subtle);
    stroke-width: 1.5;
  }

  .node-box--input {
    stroke: #EBCB8B; /* Aurora yellow */
  }

  .node-box--governance {
    fill: rgba(136, 192, 208, 0.12);
    stroke: #88C0D0; /* Frost cyan */
    stroke-width: 2;
  }

  .node-box--output {
    stroke: #A3BE8C; /* Aurora green */
  }

  /* Labels */
  .node-label {
    font-family: var(--font-sans);
    font-size: 12px;
    font-weight: 600;
    fill: var(--color-text);
  }

  .node-label--governance {
    font-size: 14px;
    font-weight: 700;
    fill: #88C0D0;
  }

  .diagram-caption {
    font-family: var(--font-mono);
    font-size: 10px;
    fill: var(--color-text-dim);
    letter-spacing: 0.05em;
  }

  /* Animated dashed connectors */
  .connector {
    stroke: var(--color-text-dim);
    stroke-width: 1.5;
    stroke-dasharray: 6 4;
    opacity: 0.5;
    animation: flow 2s linear infinite;
  }

  .connector--down { animation-delay: 0s; }
  .connector--right { animation-delay: 0.3s; }
  .connector--left { animation-delay: 0.3s; }
  .connector--fan { animation-delay: 0.6s; }

  @keyframes flow {
    from { stroke-dashoffset: 20; }
    to { stroke-dashoffset: 0; }
  }

  /* Light mode */
  :global(html.light) .node-box {
    fill: var(--color-bg-elevated);
  }

  :global(html.light) .node-box--governance {
    fill: rgba(94, 129, 172, 0.08);
    stroke: #5E81AC;
  }

  :global(html.light) .node-label--governance {
    fill: #5E81AC;
  }

  :global(html.light) .node-box--input {
    stroke: #C9A84C;
  }

  :global(html.light) .node-box--output {
    stroke: #7B9A65;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .hero-diagram__svg {
      min-width: 400px;
    }

    .hero-diagram {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .connector {
      animation: none;
    }
  }
</style>
